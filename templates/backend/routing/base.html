{% import "backend/macros.html" as macros %}
{% extends "backend/custom/surround.html" %}
{% block content %}

    {% if not foreignRecord %}
        {% set foreignRecord = False %}
    {% endif %}
    {% set record = record %}
    {% if record %}
        {% set stopUrl = url_for('.view_record', record_id=record.id, classid=classid, cmd="stop") %}
    {% else %}
        {% set stopUrl = url_for('.list_record', classid=classid, page=1) %}
    {% endif %}
            <div class="mb-4">
                <h1 class="fs-3 fw-semibold text-secondary">{{classname}}: {% if record %}{{ record.__repr__() }}{% endif %}</h1>
                <div class="d-flex align-items-center gap-2 mt-3">
                    {% if backlink %}
                        <a href="{{ backlink }}" class="btn btn-sm btn-secondary">
                            <span class="material-icons align-middle">arrow_back</span>
                        </a>
                    {% endif %}
                    {% if record %}
                        {% if not editable %}
                        <!-- Botón para editar -->
                        <a href="{{ url_for('.edit_record', record_id=record.id, classid=classid) }}" class="btn btn-sm btn-secondary"><span class="material-icons align-middle">edit</span>Editar</a>
                        {%else%}
                        <a href="{{ stopUrl }}" class="btn btn-sm btn-secondary"><span class="material-icons align-middle">stop</span>Detener</a>
                        <button type="submit" class="btn btn-sm btn-secondary" form="form-record"><span class="material-icons align-middle">save</span>Guardar</button>
                        {%endif%}
                        <!-- Botón para borrar -->
                        <form action="{{ url_for('.delete_record', record_id=record.id, classid=classid) }}" id="delete-form" method="post"
                            style="display: inline;"><input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-secondary"
                                onclick="return confirm('¿Estás seguro de que quieres eliminar esta institución?');"><span class="material-icons align-middle">delete</span>Borrar</button>
                        </form>
                    {%else%}
                        {% if editable %}
                        <button type="submit" class="btn btn-sm btn-secondary" form="form-record"><span class="material-icons align-middle">save</span>Guardar</button>

                        <a href="{{ stopUrl }}" class="btn btn-sm btn-secondary">
                            <span class="material-icons align-middle">stop</span>Detener
                        </a>
                        {% endif %}
                    {% endif %}

                </div>
            </div>
            {% if editable %}
            <form method="post" enctype="multipart/form-data" id="form-record">
            <!-- Inputs ocultos -->
            <input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}">
            {% if record %}
                <input type="hidden" id="modifiedby_id" name="modifiedby_id" value="{{ current_user.id }}" >
            {%else%}
                <input type="hidden" id="createdby_id" name="createdby_id" value="{{ current_user.id }}" >
            {% endif %}
            {% endif %}
            <div class="bg-white shadow-sm rounded-3 p-4">
                <!-- Tabs superiores -->
                <ul class="nav nav-tabs mb-3" id="mainTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="identificacion-tab" data-bs-toggle="tab"
                            data-bs-target="#identificacion" type="button" role="tab">{{classname}}</button>
                    </li>
                </ul>
                <div class="tab-content" id="mainTabContent">
                    <!-- Tab IDENTIFICACIÓN -->
                    <div class="tab-pane fade show active" id="identificacion" role="tabpanel">
                        {% for id, field in fields.items() %}
                            {{ macros.fieldForm(field, record, editable, foreignRecord) }}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {%if editable %}
            </form>
            {% endif %}
{% endblock %}