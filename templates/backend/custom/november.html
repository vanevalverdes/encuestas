{% import "backend/macros.html" as macros %}
{% extends "backend/custom/surround.html" %}

{% block content %}
<script>
function toggleDivOnSelectValue(selectId, divId, value) {
    document.addEventListener("DOMContentLoaded", function () {
        // 1. Obtener el elemento SELECT por ID
        const selectElement = document.getElementById(selectId);
        
        // 2. Obtener el DIV objetivo por ID
        const targetDiv = document.getElementById(divId);
        
        // Si el elemento SELECT o el DIV no existen, salir
        if (!selectElement || !targetDiv) return;

        // 3. Obtener todos los campos de entrada dentro del DIV objetivo
        const inputs = targetDiv.querySelectorAll("input, textarea, select");

        function toggleDiv() {
            // Obtener el valor de la opción seleccionada
            const selectedValue = selectElement.value;
            
            if (selectedValue === value) {
                // MOSTRAR el div y HABILITAR los campos
                targetDiv.style.display = "block";
                inputs.forEach(input => input.removeAttribute("disabled"));
            } else {
                // OCULTAR el div y DESHABILITAR/LIMPIAR los campos
                targetDiv.style.display = "none";
                inputs.forEach(input => {
                    // Deshabilita el campo para que no se envíe con el formulario
                    input.setAttribute("disabled", "true");
                    
                    // Opcional: Limpia los valores para evitar envíos accidentales
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else if (input.tagName === 'SELECT') {
                        // Resetea el select a la primera opción si es posible
                        input.selectedIndex = 0; 
                    } else {
                        input.value = '';
                    }
                });
            }
        }

        // 4. Agregar el listener 'change' al elemento SELECT
        selectElement.addEventListener("change", toggleDiv);

        // 5. Ejecutar la función inmediatamente al cargar la página para establecer el estado inicial
        toggleDiv();
    });
}
function toggleDivOnRadioValue(name, divId, value) {
    document.addEventListener("DOMContentLoaded", function () {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        const targetDiv = document.getElementById(divId);
        if (!targetDiv) return;
        const inputs = targetDiv.querySelectorAll("input");

        function toggleDiv() {
            const selectedValue = document.querySelector(`input[name="${name}"]:checked`)?.value;
            if (selectedValue === value) {
                targetDiv.style.display = "block";
                inputs.forEach(input => input.removeAttribute("disabled"));
            } else {
                targetDiv.style.display = "none";
                inputs.forEach(input => {
                    input.setAttribute("disabled", "true");
                    input.checked = false;
                });
            }
        }

        radios.forEach(radio => {
            radio.addEventListener("change", toggleDiv);
        });

        toggleDiv();
    });
}

function toggleDivOnRadioNotValue(name, divId, value) {
    document.addEventListener("DOMContentLoaded", function () {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        const targetDiv = document.getElementById(divId);
        if (!targetDiv) return;
        const inputs = targetDiv.querySelectorAll("input");

        function toggleDiv() {
            const selectedValue = document.querySelector(`input[name="${name}"]:checked`)?.value;
            if (selectedValue !== value && selectedValue !== undefined) {
                targetDiv.style.display = "block";
                inputs.forEach(input => input.removeAttribute("disabled"));
            } else {
                targetDiv.style.display = "none";
                inputs.forEach(input => {
                    input.setAttribute("disabled", "true");
                    input.checked = false;
                });
            }
        }

        radios.forEach(radio => {
            radio.addEventListener("change", toggleDiv);
        });

        toggleDiv();
    });
}

</script>
            <form method="post" enctype="multipart/form-data" id="form-record">
            <!-- Inputs ocultos -->
            <input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}">
            <h1>Encuesta Electoral Naranjo Opol - Enero 2026</h1>
            <div class="bg-white shadow-sm rounded-3 p-4">

                <div   id="surveyForm">
                <div class="card mb-4">
                    <div class="card-header bg-light fw-semibold">
                        Datos de la encuesta
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-12">
                                {{ macros.fieldFormSurvey(fields["gender"],record,editable)}}
                                {{ macros.fieldFormSurvey(fields["age"],record,editable)}}
                            </div>
                        </div>
                        <div class="row g-4">
                            <div class="col-md-12">
                            <!-- Cantón y Provincia -->
                                <div class="mb-3 border border-grey p-3" id="countyDiv">
                                    <label for="county" class="form-label">Cantón</label>
                                    <select class="form-select" id="county" aria-label="Cantones de Costa Rica por provincia" name="county" required>
                                    <option value="" selected disabled>Seleccione un cantón</option>
                                    
                                        <option value="naranjo">Naranjo</option>

                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row g-4">
                            <div class="col-md-12">
                                {{ macros.fieldFormSurvey(fields["willvote"],record,editable)}}
                            </div>
                            <script>
                                toggleDivOnSelectValue("willvote", "willvote-div", "Sí");
                            </script>
                        </div>
                    </div>
                </div>
                <div class="card mb-4" style="display: none;" id="willvote-div">
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-12">
                                
                                {{ macros.fieldFormSurvey(fields["nationalElection"],record,editable)}}

                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-12">
                                {{ macros.fieldFormSurvey(fields["contact"],record,editable)}}
                            </div>
                        </div>
                    </div>
                </div>
                </div> 
                <button type="submit" class="btn btn-sm btn-secondary" form="form-record"><span class="material-icons align-middle">save</span>Guardar</button>
            </form>
{% endblock %}