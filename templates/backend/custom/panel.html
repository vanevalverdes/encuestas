<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Newsroom Central: Costa Rica Election Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2b6cee",
                        "background-light": "#f8fafc",
                        "card-light": "#ffffff",
                        "border-light": "#e2e8f0"
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "body": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "2xl": "1.5rem" },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            ::-webkit-scrollbar-track {
                background: #f1f5f9; 
            }
            ::-webkit-scrollbar-thumb {
                background: #cbd5e1; 
                border-radius: 10px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #94a3b8; 
            }
        }
        .hemicircle-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            gap: 8px;
            max-width: 600px;
            margin: 0 auto;
        }
        .seat {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .seat:hover {
            transform: scale(1.2);
            z-index: 10;
        }
    </style>
    <style>
    .bg-party-pln, .bg-party-presidente_PLN { background-color: #009c3b !important; }
    .border-l-party-pln { border-color: #009c3b !important; }
    .bg-party-pusc, .bg-party-presidente_PUSC { background-color: #105ba5 !important; }
    .border-l-party-pusc { border-color: #105ba5 !important; }
    .bg-party-ppso, .bg-party-presidente_PPSO { background-color: #00bfa5 !important; }
    .border-l-party-ppso { border-color: #00bfa5 !important; }
    .bg-party-fa, .bg-party-presidente_FA { background-color: #facc15 !important; }
    .border-l-party-fa { border-color: #facc15 !important; }
    .bg-party-nr, .bg-party-presidente_NR { background-color: #8b5cf6 !important; }
    .border-l-party-nr { border-color: #8b5cf6 !important; }
    .bg-party-avanza, .bg-party-presidente_Avanza { background-color:hsl(5, 100%, 35%) !important; }
    .border-l-party-avanza { border-color: hsl(5, 100%, 35%) !important; }
    .bg-party-plp, .bg-party-presidente_PLP { background-color: #ffb400 !important; }
    .border-l-party-plp { border-color: #ffb400 !important; }
    .bg-party-actuemos, .bg-party-presidente_Actuemos { background-color: #7c3aed !important; }
    .border-l-party-actuemos { border-color: #7c3aed !important; }
    .bg-party-up, .bg-party-presidente_UP { background-color: #ff5722 !important; }
    .border-l-party-up { border-color: #ff5722 !important; }
    .bg-party-cac, .bg-party-presidente_CAC { background-color: hsl(7, 74%, 56%) !important; }
    .border-l-party-cac { border-color: hsl(7, 74%, 56%) !important; }
    .bg-party-others, .bg-party-presidente_Otros { background-color: #cbd5e1 ; }
    .border-l-party-others { border-color: #cbd5e1 !important; }
    </style>
    <style>
        /* Estilos para cuando el elemento está en modo pantalla completa */
        #data-panel:fullscreen {
            background-color: #1a202c; /* Fondo oscuro (slate-900) */
            padding: 2rem;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
        }
        
        /* Compatibilidad con navegadores antiguos */
        #data-panel:-webkit-full-screen { background-color: #1a202c; padding: 2rem; }
        #data-panel:-ms-fullscreen { background-color: #1a202c; padding: 2rem; }
    </style>
</head>

<body id="data-panel" class="bg-background-light text-slate-900 font-display h-screen flex overflow-hidden">
    <aside class="w-80 h-full flex flex-col border-r border-border-light bg-card-light sticky top-0 shrink-0">
        <div class="p-6 border-b border-border-light">
            <div class="flex items-center gap-3 mb-6">
                <div>
                    <h1 class="text-sm font-extrabold uppercase tracking-tight text-slate-800 leading-none"><img src="{{ url_for('static', filename='opol1.webp') }}" style="height: 50px; margin-right: 20px;">
                    </h1>
                </div>
            </div>
            <div class="space-y-1">
                <h2 class="text-xl font-black text-slate-900 leading-tight">Asamblea Legislativa: Boca de Urna</h2>
                <div class="flex items-center gap-2 mt-2">
                    <span class="flex h-2 w-2 relative">
                        <span
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-red-600"></span>
                    </span>
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">La página se recargará automáticamente cada 5 minutos.</span>
                </div>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            <p class="px-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Distribución total</p>
            <div class="flex flex-col gap-2">
                {% for key, value in seats.items() %}
                {% if value.total > 0 %}
                <div
                    class="flex items-center justify-between p-3 rounded-lg border border-border-light bg-slate-50 border-l-4 border-l-party-{{ key }}">
                    <div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase">{{ value.name }}</p>
                        <p class="text-lg font-bold">{{ value.total }} Diputados</p>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="p-4 border-t border-border-light space-y-2">
            <button
                class="w-full flex items-center justify-center gap-2 h-10 rounded-lg bg-primary text-white text-sm font-bold" onclick="hardRefresh()">
                <span class="material-symbols-outlined text-[18px]">refresh</span>
                <span>Recargar datos</span>
            </button>
            
        </div>
    </aside>
    <main class="flex-1 h-full overflow-y-auto bg-slate-50/50 p-8 space-y-8">
        <section class="bg-card-light border border-border-light rounded-2xl p-8 shadow-sm">
            <div class="flex items-center justify-between mb-10">
                <div>
                    <h3 class="text-2xl font-black text-slate-900 tracking-tight">Proyección de resultados</h3>
                    <p class="text-slate-500 text-sm font-medium">Composición de la Asamblea Legislativa 2026-2030</p>
                </div>
                <div class="px-4 py-2 bg-slate-100 rounded-full border border-slate-200">
                    <p class="text-xs font-bold text-slate-600">Última actualización: <span id="last-update" class="font-mono font-bold text-blue-600">Cargando...</span></p>
                </div>
            </div>
            <div class="flex flex-col items-center">
                <div class="hemicircle-container">
                    
                    {% for seat,value in seats.items() %}
                    {% for i in range(value.total) %}
                    <div class="seat bg-party-{{ seat }}"></div>
                    {% endfor %}
                    {% endfor %}
                </div>
                <div class="mt-12 flex flex-col items-center">
                    <div class="h-1 bg-slate-200 w-48 rounded-full mb-2"></div>
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">
                        Asamblea Legislativa</span>
                </div>
                <div
                    class="mt-10 grid grid-cols-3 md:grid-cols-4 gap-6 pt-8 border-t border-slate-100 w-full max-w-2xl mx-auto">
                    {% for seat,value in seats.items() %}
                    {% if value.total > 0 %}
                    <div class="flex items-center gap-2 justify-center">
                        <span class="w-3 h-3 rounded-full bg-party-{{ seat }}"></span>
                        <span class="text-[11px] font-bold text-slate-600">{{ value.name }} ({{ value.total }})</span>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </section>
        <section class="bg-card-light border border-border-light rounded-2xl p-8 shadow-sm">
            <div class="flex items-center justify-between mb-10">
                <div>
                    <p class="text-slate-500 text-sm font-medium">Votos a la Presidencia de la República</p>
                </div>
            </div>
            <div class="flex flex-col items-center">
                <div class="w-full">
                    <!-- Barra de Progreso Acumulada -->
                    <div class="h-3 w-full bg-slate-100 rounded-full overflow-hidden flex shadow-inner">
                        {% for party_key, data in seats["presidencia"]["partys"].items() %}
                            {% if data.total > 0 %}
                                {% set percent = (data.total / seats["presidencia"]["totalPresidencia"] * 100) if seats["presidencia"]["totalPresidencia"] > 0 else 0 %}
                                <!-- Usamos style para el ancho dinámico y reemplazamos 'presidente_' para la clase de color si es necesario -->

                                <div class="h-full bg-party-presidente_Otros bg-party-{{ party_key }} w-[{{ percent|round(2) }}%]"></div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Leyenda con Porcentajes -->
                <div class="mt-10 grid grid-cols-2 md:grid-cols-4 gap-4 pt-8 border-t border-slate-100 w-full">
                    {% for party_key, data in seats["presidencia"]["partys"].items() %}
                        {% if data.total > 0 %}
                            {% set percent = (data.total / seats["presidencia"]["totalPresidencia"] * 100) if seats["presidencia"]["totalPresidencia"] > 0 else 0 %}
                            <div class="flex flex-col items-start px-2">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-3 h-3 rounded-full bg-party-{{ party_key.replace('presidente_', '') }}"></span>
                                    <span class="text-[10px] uppercase tracking-wider font-bold text-slate-400">
                                        {{ party_key.replace('presidente_', '') }}
                                    </span>
                                </div>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-lg font-bold text-slate-700">{{ percent|round(2) }}%</span>
                                    <span class="text-[10px] text-slate-400">({{ data.total }})</span>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </section>

    </main>
    <aside class="w-96 h-full flex flex-col bg-card-light border-l border-border-light shadow-2xl relative z-10">
        <div class="p-6 border-b border-border-light bg-slate-50/50">
            <!-- Botón de Pantalla Completa -->
            <button id="fullscreen-btn" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors font-medium text-sm">
                <svg id="expand-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
                <span id="btn-text">Pantalla Completa</span>
            </button>
            <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest flex items-center gap-2 mb-4">
                <span class="material-symbols-outlined text-primary text-xl">broadcast_on_home</span>
                Diputados Electos
            </h3>
            <form action="">
            <div class="grid grid-cols-2 gap-2">
                <select 
                    name="state" 
                    class="block w-full text-xs font-bold rounded-lg border-slate-200 bg-white focus:ring-primary cursor-pointer"
                    onchange="this.form.submit()"
                >
                    <option value="">Todas las Provincias</option>
                    {% set provinces = [
                        ('San José', 'San José'),
                        ('Alajuela', 'Alajuela'),
                        ('Cartago', 'Cartago'),
                        ('Heredia', 'Heredia'),
                        ('Guanacaste', 'Guanacaste'),
                        ('Puntarenas', 'Puntarenas'),
                        ('Limón', 'Limón')
                    ] %}
                    
                    {% for val, label in provinces %}
                        <option value="{{ val }}" {% if request.args.state == val %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                <select class="block w-full text-xs font-bold rounded-lg border-slate-200 bg-white focus:ring-primary" name="party" onchange="this.form.submit()">
                    <option value="">Todos los partidos</option>
                    <option value="ppso" {% if request.args.party == 'ppso' %}selected{% endif %}>PPSO</option>
                    <option value="pln" {% if request.args.party == 'pln' %}selected{% endif %}>PLN</option>
                    <option value="fa" {% if request.args.party == 'fa' %}selected{% endif %}>FA</option>
                    <option value="cac" {% if request.args.party == 'cac' %}selected{% endif %}>CAC</option>
                    <option value="pusc" {% if request.args.party == 'pusc' %}selected{% endif %}>PUSC</option>
                    <option value="avanza" {% if request.args.party == 'avanza' %}selected{% endif %}>Avanza</option>
                    <option value="actuemos" {% if request.args.party == 'actuemos ya' %}selected{% endif %}>Actuemos Ya</option>
                    <option value="up" {% if request.args.party == 'up' %}selected{% endif %}>UP</option>
                    <option value="nr" {% if request.args.party == 'nr' %}selected{% endif %}>NR</option>
                    <option value="plp" {% if request.args.party == 'plp' %}selected{% endif %}>PLP</option>
                </select>
            </div>
            </form>
        </div>
        <div class="flex-1 overflow-y-auto px-4 py-6 space-y-4">
        {% if request.args.party %}
        {% set party = request.args.party %}
        {% set value = seats[party] %}
        
            {% if value.total > 0 and value.diputados %}
                {% if value.sanjose > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de San José #}
                        {% if record.state == 'San José' and ns.count < value.sanjose %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.alajuela > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Alajuela #}
                        {% if record.state == 'Alajuela' and ns.count < value.alajuela %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.heredia > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Heredia #}
                        {% if record.state == 'Heredia' and ns.count < value.heredia %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.cartago > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Cartago #}
                        {% if record.state == 'Cartago' and ns.count < value.cartago %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.guanacaste > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Guanacaste #}
                        {% if record.state == 'Guanacaste' and ns.count < value.guanacaste %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.puntarenas > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Puntarenas #}
                        {% if record.state == 'Puntarenas' and ns.count < value.puntarenas %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.limon > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Limón #}
                        {% if record.state == 'Limón' and ns.count < value.limon %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        {% else %}
        {% for party, value in seats.items() %}
            {% if value.total > 0 and value.diputados %}
                {% if value.sanjose > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de San José #}
                        {% if record.state == 'San José' and ns.count < value.sanjose %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.alajuela > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Alajuela #}
                        {% if record.state == 'Alajuela' and ns.count < value.alajuela %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.heredia > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Heredia #}
                        {% if record.state == 'Heredia' and ns.count < value.heredia %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.cartago > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Cartago #}
                        {% if record.state == 'Cartago' and ns.count < value.cartago %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.guanacaste > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Guanacaste #}
                        {% if record.state == 'Guanacaste' and ns.count < value.guanacaste %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.puntarenas > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Puntarenas #}
                        {% if record.state == 'Puntarenas' and ns.count < value.puntarenas %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if value.limon > 0 %}
                    {# Usamos namespace para que el contador sea persistente #}
                    {% set ns = namespace(count=0) %}
                    
                    {% for record in value.diputados %}
                        {% set record = record|toORM() %}
                        
                        {# Verificamos el estado y que no hayamos superado el límite de Limón #}
                        {% if record.state == 'Limón' and ns.count < value.limon %}
                            <div class="group p-4 rounded-xl border border-border-light hover:border-slate-300 hover:bg-slate-50 transition-all cursor-pointer">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        {% if record.image_id %}
                                            {% set url_image = url_for('application.get_blob', blob_id=record.image_id) %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 bg-center bg-cover"
                                                style="background-image: url('{{ url_image }}');">
                                            </div>
                                        {% else %}
                                            <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm bg-slate-200 flex items-center justify-center overflow-hidden">
                                                <svg class="w-full h-full text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                        <div class="absolute -bottom-1 -right-1 bg-party-{{party}} rounded-full p-0.5 border-2 border-white">
                                            <span class="block w-2 h-2 rounded-full bg-white"></span>
                                        </div>
                                    </div>

                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <h4 class="text-sm font-bold text-slate-900 truncate">{{ record.name }}</h4>
                                            <span class="text-[10px] font-black text-party-{{party}} uppercase">Confirmado</span>
                                        </div>
                                        <div class="flex justify-between items-end mt-1">
                                            <p class="text-[11px] font-bold text-slate-400">{{record.party}} • {{ record.state }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {# Incrementamos el contador del namespace #}
                            {% set ns.count = ns.count + 1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        {% endfor %}
        {% endif %}
        </div>
        <div class="p-4 border-t border-border-light space-y-2">
            <a href="{{ url_for('application.logout') }}"
                class="w-full flex items-center justify-center gap-2 h-10 rounded-lg bg-primary text-white text-sm font-bold">
                <span class="material-symbols-outlined text-[18px]">exit_to_app</span>
                <span>Salir</span>
        </a>
        </div>
    </aside>
</body>
<script>
        /**
         * Función para formatear y mostrar la hora actual
         */
        function updateTimestamp() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0'); // Opcional
            
            const timeString = `${hours}:${minutes}:${seconds} hrs`;
            
            // Mostrar en el DOM
            document.getElementById('last-update').textContent = timeString;
        }
        function hardRefresh() {
            // window.location.origin + pathname elimina todo lo que esté después del '?'
            window.location.href = window.location.origin + window.location.pathname;
        }
        /**
         * Función para configurar la recarga automática
         * @param {number} minutes - Intervalo en minutos
         */
        function setupAutoRefresh(minutes) {
            const ms = minutes * 60 * 1000;
            
            setTimeout(() => {
                // Si necesitas usar un refresh token antes de recargar,
                // podrías llamar a tu lógica de validación aquí.
                console.log("Recargando página...");
                window.location.reload();
            }, ms);
        }

        // Ejecutar al cargar la página
        window.onload = () => {
            // 1. Mostrar la hora en que se cargó/actualizó la página
            updateTimestamp();

            // 2. Iniciar cronómetro de 5 minutos para recarga
            setupAutoRefresh(5);
        };
    </script>
        <script>
        const dataPanel = document.getElementById('data-panel');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const btnText = document.getElementById('btn-text');
        const expandIcon = document.getElementById('expand-icon');
        const restoreOverlay = document.getElementById('fullscreen-restore-overlay');

        // --- LÓGICA DE FULLSCREEN ---

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            const requestMethod = dataPanel.requestFullscreen || dataPanel.webkitRequestFullscreen || dataPanel.mozRequestFullScreen || dataPanel.msRequestFullscreen;
            if (requestMethod) {
                requestMethod.call(dataPanel);
                sessionStorage.setItem('wasFullscreen', 'true'); // Guardamos el estado
            }
        }

        function exitFullscreen() {
            const exitMethod = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;
            if (exitMethod) {
                exitMethod.call(document);
                sessionStorage.removeItem('wasFullscreen'); // Limpiamos el estado
            }
        }

        function updateUI() {
            if (document.fullscreenElement) {
                btnText.textContent = "Salir";
                expandIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7"/></svg>';
                restoreOverlay.style.display = 'none';
            } else {
                btnText.textContent = "Pantalla Completa";
                expandIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>';
            }
        }

        // --- LÓGICA DE REFRESH ---

        function updateTimestamp() {
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleTimeString() + " hrs";
        }

        function setupAutoRefresh(minutes) {
            setTimeout(() => {
                // Si la sesión sigue marcada como fullscreen, el overlay aparecerá tras recargar
                window.location.reload();
            }, minutes * 60 * 1000);
        }

        // --- INICIALIZACIÓN ---

        window.onload = () => {
            updateTimestamp();
            setupAutoRefresh(5);

            // Verificar si veníamos de estar en pantalla completa
            if (sessionStorage.getItem('wasFullscreen') === 'true') {
                restoreOverlay.style.display = 'flex';
            }
        };

        // Eventos
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        restoreOverlay.addEventListener('click', () => {
            enterFullscreen();
        });

        document.addEventListener('fullscreenchange', updateUI);
        document.addEventListener('webkitfullscreenchange', updateUI);
    </script>
</html>